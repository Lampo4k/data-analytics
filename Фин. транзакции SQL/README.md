# Проект: Анализ финансовых транзакций с использованием CTE

## Описание проекта
Цель проекта — анализ финансовых транзакций и конвертации сумм в различных валютах в USD. Создание гибкой функции для получения курса валют, которая может быть использована в других запросах и аналитических задачах.


## Технологии
- **SQL**
- **PostgreSQL**


### Файл 1: `rename_table_and_create_function.sql`

**Создание функции `last_rate`:**
   - Функция возвращает последний курс валюты к доллару США (`rate_to_usd`) на основе переданного названия валюты.
   - Если название валюты не указано (`NULL`), функция возвращает значение `1.0`.
   - Функция использует данные из таблицы `currency`, выбирая курс, актуальный на момент последнего обновления.

---

### Файл 2: `currency_analysis.sql`
Этот файл содержит SQL-код, который выполняет следующие задачи:

**Анализ финансовых операций:**
   - Создан запрос, который:
     - Объединяет данные из таблиц `balance`, `currency` и `person`.
     - Вычисляет актуальный курс валюты для каждой операции, используя ближайший доступный курс на дату операции.
     - Конвертирует суммы операций в доллары США.
     - Заменяет `NULL` значения на понятные метки (`<not defined>`).
   - Результаты отсортированы по имени пользователя, фамилии и названию валюты.

