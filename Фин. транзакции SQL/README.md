# Проект: Анализ финансовых транзакций с использованием CTE

## Описание проекта
Цель проекта — анализ финансовых транзакций и конвертации сумм в различных валютах в USD. Создание гибкой функции для получения курса валют, которая может быть использована в других запросах и аналитических задачах.

## Стек
- **SQL**
- **PostgreSQL**


### Файл 1: `func_last_rate.sql`
Этот файл содержит SQL-запрос для анализа балансов пользователей. Он агрегирует данные из таблицы `balance`, объединяет их с таблицами `user` и `currency`, использует функцию `last_rate` для получения последнего курса валюты и конвертирует суммы в доллары США. Результат включает имя, фамилию, тип баланса, объем, название валюты, курс и сумму в USD. Заменяет `NULL` на `'not defined'`. Сортировка: по имени (убывание), фамилии и типу.

---

### Файл 2: `CTE_func.sql`
Этот файл добавляет новые курсы валют и использует CTE `func` для расчета сумм в USD. Он ищет ближайший курс валюты (до или после даты баланса), объединяет данные из `balance`, `currency` и `user`, и конвертирует суммы. Результат включает имя, фамилию, валюту и сумму в USD. Заменяет `NULL` на `'<not defined>'`. Сортировка: по имени (убывание), фамилии и валюте.

